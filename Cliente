# client.py
import socket
import threading
from tkinter import Tk, Text, Entry, Button, END, DISABLED, NORMAL

class ChatClient:
    def __init__(self):
        self.client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.client_socket.connect(('127.0.0.1', 5555))

        # Interfaz
        self.root = Tk()
        self.root.title("Cliente - UNAL Chat")
        self.root.geometry("600x550")

        self.chat = Text(self.root, state=DISABLED, wrap="word")
        self.chat.pack(padx=10, pady=10, fill="both", expand=True)

        # Mensajes propios en azul (para diferenciar del servidor rojo)
        self.chat.tag_config("me", foreground="blue")

        self.entry = Entry(self.root, font=("Arial", 10))
        self.entry.pack(side="left", fill="x", expand=True, padx=10, pady=(0,10))
        self.entry.bind("<Return>", self.enviar)

        self.btn = Button(self.root, text="Enviar", command=self.enviar)
        self.btn.pack(side="right", padx=10, pady=(0,10))

        self.log("âœ… Conectado al servidor.")
        threading.Thread(target=self.recibir, daemon=True).start()
        self.root.mainloop()

    def recibir(self):
        while True:
            msg = self.client_socket.recv(1024).decode()
            if not msg:
                break
            self.log(f"Servidor: {msg}")

    def enviar(self, event=None):
        msg = self.entry.get().strip()
        if msg:
            self.client_socket.send(msg.encode())
            self.log(f"Yo: {msg}", quien="me")
            self.entry.delete(0, END)

    def log(self, texto, quien=""):
        self.chat.config(state=NORMAL)
        self.chat.insert(END, texto + "\n", quien)
        self.chat.see(END)
        self.chat.config(state=DISABLED)


if __name__ == "__main__":
    ChatClient()
